<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Your IP</title>
<style>
  body {
    margin: 0;
    background-color: #080f13;
    color: white;
    font-size: 16px;
    text-align: center;
    font-family: sans-serif;
  }
  #vpn-warning {
    color: red;
    font-weight: bold;
    margin-bottom: 1em;
    display: none;
  }
  #info div {
    margin: 0.3em 0;
  }
</style>
</head>
<body>
  <div id="vpn-warning">You are using a VPN! The information displayed may be inaccurate!</div>
  <div id="info">Loading IP...</div>

<script>
  const ipinfoToken = '5b5227270a94be'; // optional, leave empty '' if none
  const proxycheckApiKey = 'public-14f5m4-21056r-g8od20'; // required for proxycheck.io

  async function getIpInfo() {
    const url = 'https://ipinfo.io/json' + (ipinfoToken ? '?token=' + ipinfoToken : '');
    const response = await fetch(url);
    if (!response.ok) throw new Error('Failed to fetch IP info');
    return response.json();
  }

  async function checkVpn(ip) {
    const url = `https://proxycheck.io/v2/${ip}?key=${proxycheckApiKey}&vpn=1&asn=1&node=1`;
    const response = await fetch(url);
    if (!response.ok) throw new Error('Failed to fetch VPN info');
    return response.json();
  }

  function displayInfo(data, vpnDetected) {
    const infoEl = document.getElementById('info');
    let html = '';

    // ipinfo only returns one IP string, might be IPv4 or IPv6
    const ip = data.ip || '';
    const isIPv6 = ip.includes(':');
    const isIPv4 = !isIPv6;

    if (isIPv4) {
      html += `<div>IPv4: ${ip}</div>`;
    } else if (isIPv6) {
      html += `<div>IPv6: ${ip}</div>`;
    }

    html += `<div>ISP: ${data.org || 'Unknown'}</div>`;
    html += `<div>City: ${data.city || 'Unknown'}, ${data.region || 'Unknown'}, ${data.country || 'Unknown'}</div>`;

    infoEl.innerHTML = html;

    const vpnWarningEl = document.getElementById('vpn-warning');
    if (vpnDetected) {
      vpnWarningEl.style.display = 'block';
    } else {
      vpnWarningEl.style.display = 'none';
    }
  }

  async function main() {
    try {
      const ipInfo = await getIpInfo();
      const ip = ipInfo.ip;

      let vpnDetected = false;
      if (ip) {
        const vpnInfo = await checkVpn(ip);
        // proxycheck.io returns structure: { "ip": { "proxy": "yes"/"no", "vpn": "yes"/"no", "tor": "yes"/"no", ... } }
        if (vpnInfo[ip] && (vpnInfo[ip].vpn === "yes" || vpnInfo[ip].proxy === "yes" || vpnInfo[ip].tor === "yes")) {
          vpnDetected = true;
        }
      }

      displayInfo(ipInfo, vpnDetected);
    } catch (e) {
      console.error(e);
      document.getElementById('info').innerHTML = '<div style="color:red;">Failed to load IP information</div>';
      document.getElementById('vpn-warning').style.display = 'none';
    }
  }

  main();
</script>

</body>
</html>
